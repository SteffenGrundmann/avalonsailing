<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html><head>
<title>Bus</title>
</head>

<body onload="start()" style="background:gray;">

<div id="menu">
  <a href="control.html" target="control">Control</a>
  <a href="bus.html" target="bus"  style="background:gray;">Bus</a>
  <a href="plan.html" target="plan">Plan</a>
  <a href="log.html" target="log">Log</a>
</div>

<div id="view"></div>


<script>
function e(id) { return document.getElementById(id) }

var ws

function start() {
    var nan = Number.NaN  // needed for eval of "label":nan in msg

    ws = new WebSocket("ws://" + window.location.host + "/lbus");
    ws.onmessage = function (evt) {
	var msg = eval('('+evt.data+')')
	if (msg == null) return
        for (x in msg) {
		if (!e(x)) {
		    e("view").appendChild(document.createElement('div')).id = x
                }
	    e(x).innerHTML = x + ": " + JSON.stringify(msg[x], null, "\t")
	}

    };

    ws.onopen  = function(err) { document.body.style.background = 'white' }
    ws.onclose = function(err) { document.body.style.background = 'darkgrey' }
    ws.onerror = function(err) { document.body.style.background = 'red' }

}


</script>
</body></html>